IMPORT "std.mars"
PROCEDURE copy_stack
ARG stack_to_copy
IDENTIFIER "stack_to_copy"
SWITCH
SPAWN "replacement_stack"
VARIABLE stack_copy
DUP
ENDVARIABLE

VARIABLE index
PUSH 0
ENDVARIABLE

IDENTIFIER "index"
IDENTIFIER "stack_to_copy"
STACKSIZE
LT
VARIABLE current
IDENTIFIER "[index"
IDENTIFIER "]"
ENDVARIABLE

IDENTIFIER "stack_copy"
SWITCH
IDENTIFIER "current"
IDENTIFIER "stack_to_copy"
SWITCH
VARIABLE index
IDENTIFIER "index"
PUSH 1
ADD
ENDVARIABLE

ENDWHILE
IDENTIFIER "this_stack"
SWITCH
IDENTIFIER "stack_copy"
ENDPROCEDURE

PROCEDURE puts
ARG string
VARIABLE prev_stack
THIS
ENDVARIABLE

IDENTIFIER "string"
DUP
SWITCH
STACKREV
VARIABLE counter
PUSH 0
ENDVARIABLE

VARIABLE size
STACKSIZE
ENDVARIABLE

IDENTIFIER "counter"
IDENTIFIER "size"
LT
PRINTASCII
VARIABLE counter
IDENTIFIER "counter"
PUSH 1
ADD
ENDVARIABLE

ENDWHILE
IDENTIFIER "prev_stack"
SWITCH
CLOSE
ENDPROCEDURE

PROCEDURE eputs
ARG string
IDENTIFIER "string"
IDENTIFIER "puts"
PUSH 1
EXIT
ENDPROCEDURE

ENDIMPORT

STRING SPAWN "Hello_World_"
DUP
SWITCH
PUSH 72
PUSH 101
PUSH 108
PUSH 108
PUSH 111
PUSH 44
PUSH 32
PUSH 87
PUSH 111
PUSH 114
PUSH 108
PUSH 100
PUSH 33
PUSH 10
STACK "main"
SWITCH
STACK "Hello_World_"

IDENTIFIER "puts"
